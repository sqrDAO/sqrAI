# @sqrdao/plugin-github

## Introduction

This folder contains the source code for the `@sqrdao/plugin-github` package, a plugin designed to integrate with GitHub repositories. It provides actions for cloning, summarizing, querying, generating documentation, creating files, and creating pull requests. This plugin also utilizes a PostgreSQL database to store information about cloned repositories and their files.

## File Descriptions

*   **`.npmignore`**: Specifies files that should be ignored when publishing the package to npm.
*   **`eslint.config.mjs`**: Configuration file for ESLint, extending the global ESLint configuration.
*   **`package.json`**: Defines the package's metadata, dependencies, and scripts for building and linting.
*   **`schema.sql`**: SQL schema for creating tables in the PostgreSQL database to store repository and code file information including embeddings for semantic search.
*   **`src/actions/clone.ts`**: Implements actions for cloning a GitHub repository and saving file information to the database including embeddings of the content of each file..
*   **`src/actions/createPR.ts`**: Implements an action to create a pull request on GitHub based on context generated by LLM.
*   **`src/actions/createfile.ts`**: Implements an action to create a file in a specified directory with the provided content based on context generated by LLM.
*   **`src/actions/gendoc.ts`**: Implements an action to generate documentation (README.md) for a given folder within a repository based on context generated by LLM.
*   **`src/actions/summarize.ts`**: Implements an action to summarize a cloned GitHub repository, extracting key information such as programming languages, frameworks, and important files based on context generated by LLM.
*   **`src/actions/utils.ts`**: Provides utility functions for file system operations, such as getting the file structure and loading file contents, and generating text.
*   **`src/constants.ts`**: Defines constants used within the plugin, such as the repository key.
*   **`src/index.ts`**: The main entry point for the plugin, initializing database connection, defining actions like query project, and registering all actions with eliza framework.
*   **`src/repo_api.ts`**: Defines an Express router for API endpoints related to repositories (e.g., fetching a list of repositories).
*   **`src/services/pg.ts`**: Implements a singleton pattern for managing the PostgreSQL database connection pool.
*   **`src/utils.ts`**: Provides utility functions for extracting repository information, querying repositories, querying related code files by embeddings, and fetching a list of all repositories.
*   **`tsconfig.json`**: Configuration file for TypeScript compilation settings.
*   **`tsup.config.ts`**: Configuration file for tsup bundler, defining build settings for the project.

## Usage Instructions

### General Setup

1.  Ensure you have Node.js and npm installed.
2.  Install the dependencies by running `npm install` in the `packages/plugin-github` directory or the root directory with workspace setup .
3.  Set up a PostgreSQL database and configure the `POSTGRES_URL` environment variable with your database connection string.
4. Set up `GITHUB_API_TOKEN` environment variable with your github token.

### Running the plugin
This plugin is design to work with `@ai16z/eliza` framework. Please refer to that framework for how to use it.

### Individual File Usage

*   **`src/actions/clone.ts`**: This file contains functions that are part of the `CLONE_REPO` action, which can be triggered via the Eliza Framework. The action clones a repository from a given URL and indexes its content in database for semantic search.
    *   Example message: `"Clone this repository: https://github.com/ai16z/eliza"`

*   **`src/actions/createPR.ts`**: This file contains functions that are part of the `CREATE_PULL_REQUEST` action, which can be triggered via the Eliza Framework. The action creates a pull request on GitHub based on context generated by LLM using simple-git and Octokit library..
    *   Example message: `"Create a pull request"`

*   **`src/actions/createfile.ts`**: This file contains functions that are part of the `CREATE_FILE` action, which can be triggered via the Eliza Framework. The action creates a file in specified folder with content based on context generated by LLM using node fs library..
     *  Example message: `"Create file in folder /path/to/folder with content: Hello, World!"`

*   **`src/actions/gendoc.ts`**: This file contains functions that are part of the `GEN_DOC` action, which can be triggered via the Eliza Framework. The action generates a README.md file for a given folder within a repository based on context generated by LLM.
    *   Example message: `"Generate documentation for code in repository project-management-tool and folder src/utils"`

*   **`src/actions/summarize.ts`**: This file contains functions that are part of the `SUMMARIZE_REPO` action, which can be triggered via the Eliza Framework. This action summarizes a cloned repository to extract key information such as programming languages, frameworks, and important files based on context generated by LLM
    *   Example message: `"Summarize this repository."`

*   **`src/index.ts`**: Entry point of plugin, defines how all actions and plugin should be initialized. It also initializes database connection and register routes for API endpoints
    * Not directly executable but is used when instantiating the plugin with eliza framework

* ** `src/repo_api.ts`:**
     * Run using express js framework and provides API endpoints for fetching a list of repositories.
     *  Example usage : `GET /repos`

### Build Commands

*   **`npm run build`**: Builds the project using `tsup`, generating JavaScript files in the `dist` directory.
*   **`npm run dev`**: Builds the project in watch mode using `tsup`, which will rebuild on file changes.
*   **`npm run lint`**: Runs ESLint to check for code quality and formatting issues.

## Dependencies

### Libraries

*   `@ai16z/eliza`: Core framework for AI agents.
*   `@types/express`: Type definitions for Express.js.
*    `express`: Web framework for Node.js.
*   `@octokit/rest`: GitHub REST API client.
*   `@octokit/types`: Type definitions for Octokit.
*   `@types/pg`: Type definitions for PostgreSQL.
*   `pg`: PostgreSQL client for Node.js.
*   `simple-git`: A simple interface for interacting with git repositories.
*    `tsup`: TypeScript bundler.
*   `eslint`: JavaScript linter.
*   `eslint-config-prettier`: ESLint configuration for Prettier.
*   `eslint-plugin-prettier`: ESLint plugin for Prettier.
*   `eslint-plugin-vitest`: ESLint plugin for Vitest.
*   `typescript`: TypeScript compiler.

### Tools

*   Node.js: JavaScript runtime environment.
*   npm: Node package manager.
*   PostgreSQL: Relational database system.
*   git: Version control system.

## Additional Notes

*   The plugin uses environment variables (`POSTGRES_URL`, `GITHUB_API_TOKEN`) for configuration. Ensure these are set before running the plugin.
*   The database schema is defined in `schema.sql`. Run this script against your PostgreSQL database to create the necessary tables.
*   The plugin stores cloned repositories in a `.repos` directory within the current working directory of eliza agent.
*   The embedding dimension is set to 384, but can be changed in  `schema.sql`.
*   The `queryProjectAction` attempts to answer user questions about a project by using semantic search and reading related code files based on context generated by LLM.

This README provides a comprehensive overview of the `@sqrdao/plugin-github` package, including its purpose, file descriptions, usage instructions, dependencies, and additional notes..
 
source repo: /app/agent/.repos/sqrDAO/sqrAI